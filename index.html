<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mihomo Configurator</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app">
  <header class="header">
    <a class="github-link" href="https://github.com/123jjck/mihomo-configurator" target="_blank" rel="noopener noreferrer" aria-label="GitHub repository" title="GitHub repository">
      <svg viewBox="0 0 16 16" width="18" height="18" aria-hidden="true" focusable="false">
        <path fill="currentColor" d="M8 0a8 8 0 0 0-2.53 15.59c.4.07.55-.17.55-.39l-.01-1.36c-2.24.49-2.71-1.08-2.71-1.08-.37-.93-.9-1.18-.9-1.18-.73-.5.06-.49.06-.49.81.06 1.23.83 1.23.83.71 1.23 1.88.87 2.34.67.07-.52.28-.87.51-1.07-1.79-.2-3.67-.9-3.67-4a3.13 3.13 0 0 1 .83-2.17c-.09-.21-.36-1.03.08-2.15 0 0 .67-.22 2.2.83a7.6 7.6 0 0 1 4 0c1.53-1.05 2.2-.83 2.2-.83.44 1.12.17 1.94.08 2.15.52.57.83 1.3.83 2.17 0 3.11-1.88 3.8-3.67 4 .29.25.54.74.54 1.5l-.01 2.22c0 .22.15.47.55.39A8 8 0 0 0 8 0Z"/>
      </svg>
    </a>
    <div class="lang-switch">
      <label id="lang-switch-label" class="field-label" for="lang-switch">–Ø–∑—ã–∫</label>
      <select class="field-input lang-select" id="lang-switch">
        <option value="ru" id="lang-option-ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="en" id="lang-option-en">English</option>
      </select>
    </div>
    <h1 id="app-title">Mihomo Configurator</h1>
    <p id="app-subtitle">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ <a href="https://github.com/MetaCubeX/mihomo" target="_blank" style="color:#267cff">mihomo</a></p>
  </header>

  <nav class="steps" id="steps-nav"></nav>

  <!-- Step 1: DNS -->
  <section class="step-content active" data-step="0">
    <div class="card">
      <h2 id="dns-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS</h2>
      <p class="card-desc" id="dns-desc">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS-—Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–∞ –¥–æ–º–µ–Ω–æ–≤</p>
      <p class="hint" id="dns-main-hint">–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —á—Ç–æ-–ª–∏–±–æ –º–µ–Ω—è—Ç—å –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –µ—Å–ª–∏ –≤—ã –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç–µ.</p>
      <!-- IPv6 toggle hidden intentionally (advanced setting). -->
      <div class="field ipv6-field">
        <label class="field-label" id="ipv6-label">IPv6</label>
        <select class="field-input" id="ipv6-toggle" onchange="state.ipv6=this.value==='true'" style="max-width:200px">
          <option value="false" id="ipv6-off">–û—Ç–∫–ª—é—á—ë–Ω</option>
          <option value="true" id="ipv6-on">–í–∫–ª—é—á—ë–Ω</option>
        </select>
      </div>
    </div>

    <div class="card">
      <h3 id="dns-default-title">Default Nameservers</h3>
      <p class="hint" id="dns-default-hint">DNS-—Å–µ—Ä–≤–µ—Ä—ã (IP), —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∑–æ–ª–≤—è—Ç—Å—è –∞–¥—Ä–µ—Å–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö nameserver</p>
      <div class="presets" id="dns-default-presets"></div>
      <div id="dns-default-list"></div>
      <div class="add-row">
        <input class="field-input" id="dns-default-input" placeholder="9.9.9.9" onkeydown="if(event.key==='Enter')addDnsServer('default')">
        <button class="btn btn-sm btn-primary" id="dns-default-add-btn" onclick="addDnsServer('default')">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>

    <div class="card">
      <h3 id="dns-ns-title">Nameservers</h3>
      <p class="hint" id="dns-ns-hint">–û—Å–Ω–æ–≤–Ω—ã–µ DNS-—Å–µ—Ä–≤–µ—Ä—ã (DoH / DoT) –¥–ª—è —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–∞ –¥–æ–º–µ–Ω–æ–≤</p>
      <div class="presets" id="dns-ns-presets"></div>
      <div id="dns-ns-list"></div>
      <div class="add-row">
        <input class="field-input" id="dns-ns-input" placeholder="https://dns.quad9.net/dns-query" onkeydown="if(event.key==='Enter')addDnsServer('ns')">
        <button class="btn btn-sm btn-primary" id="dns-ns-add-btn" onclick="addDnsServer('ns')">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </section>

  <!-- Step 2: Servers -->
  <section class="step-content" data-step="1">
    <div class="card">
      <h2 id="servers-title">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤</h2>
      <p class="card-desc" id="servers-desc">–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä—ã –∏–∑ —Å—Å—ã–ª–æ–∫ –∏–ª–∏ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</p>
      <p class="hint" id="servers-hint">–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∏–∫—É–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è.</p>
    </div>

    <div class="card">
      <h3 id="links-title">–ò–∑ —Å—Å—ã–ª–æ–∫</h3>
      <p class="hint" id="links-hint">–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏ –ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É: vless://, vmess://, ss://, trojan://, hysteria2://, hy2://, tuic:// –∏–ª–∏ URL –ø–æ–¥–ø–∏—Å–∫–∏ https://...</p>
      <textarea class="field-input" id="proxy-urls" rows="5" placeholder="vless://uuid@server:443?type=tcp&security=reality&...#Name&#10;hysteria2://password@server:443?...#Name"></textarea>
      <div style="margin-top:10px">
        <button class="btn btn-primary" id="links-add-btn" onclick="addProxiesFromUrls()">–î–æ–±–∞–≤–∏—Ç—å –∏–∑ —Å—Å—ã–ª–æ–∫</button>
      </div>
    </div>

    <div class="card">
      <h3 id="file-title">–ò–∑ —Ñ–∞–π–ª–∞ (WireGuard / AmneziaWG)</h3>
      <p class="hint" id="file-hint">–ó–∞–≥—Ä—É–∑–∏—Ç–µ .conf —Ñ–∞–π–ª. AmneziaWG –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
      <div class="file-input-wrap">
        <input type="file" id="wg-file" accept=".conf,.txt" onchange="addProxyFromFile(this)">
      </div>
    </div>

    <div class="card" id="proxy-list-card" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h3 id="proxy-list-title" style="margin:0">–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏ (0)</h3>
        <button class="btn btn-sm btn-danger" id="proxy-clear-btn" onclick="clearProxies()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
      </div>
      <div style="overflow-x:auto">
        <table class="proxy-table">
          <thead><tr><th id="proxy-th-name">–ò–º—è</th><th id="proxy-th-type">–¢–∏–ø</th><th id="proxy-th-server">–°–µ—Ä–≤–µ—Ä</th><th id="proxy-th-port">–ü–æ—Ä—Ç</th><th></th></tr></thead>
          <tbody id="proxy-tbody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Step 3: Rules -->
  <section class="step-content" data-step="2">
    <div class="card">
      <h2 id="rules-title">–ü—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏</h2>
      <p class="card-desc" id="rules-desc">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ, –∫–∞–∫–æ–π —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å, –∞ –∫–∞–∫–æ–π –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø—Ä—è–º—É—é</p>

      <h3 id="rules-services-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã</h3>
      <div class="presets" id="presets-services"></div>

      <h3 id="rules-cdn-title" style="margin-top:16px">CDN</h3>
      <p class="hint" id="rules-cdn-hint">IP-–¥–∏–∞–ø–∞–∑–æ–Ω—ã CDN-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è</p>
      <div class="presets" id="presets-cdn"></div>

      <h3 id="rules-other-title" style="margin-top:16px">–ü—Ä–æ—á–µ–µ</h3>
      <div class="presets" id="presets-other"></div>
    </div>

    <div class="card">
      <h3 id="rule-manual-title">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –≤—Ä—É—á–Ω—É—é</h3>
      <div class="rule-form">
        <select class="field-input" id="rule-type">
          <option value="DOMAIN-SUFFIX">DOMAIN-SUFFIX</option>
          <option value="DOMAIN">DOMAIN</option>
          <option value="DOMAIN-KEYWORD">DOMAIN-KEYWORD</option>
          <option value="IP-CIDR">IP-CIDR</option>
          <option value="SRC-IP-CIDR">SRC-IP-CIDR</option>
          <option value="GEOIP">GEOIP</option>
          <option value="GEOSITE">GEOSITE</option>
          <option value="PROCESS-NAME">PROCESS-NAME</option>
        </select>
        <input class="field-input" id="rule-payload" placeholder="google.com" onkeydown="if(event.key==='Enter')addRule()">
        <select class="field-input" id="rule-target"></select>
        <button class="btn btn-primary" id="rule-add-btn" onclick="addRule()">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>

    <div class="card">
      <h3 id="rules-current-title">–¢–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞</h3>
      <div id="rules-list"></div>
      <div class="match-rule">
        <span id="match-label">–û—Å—Ç–∞–ª—å–Ω–æ–π —Ç—Ä–∞—Ñ–∏–∫ (MATCH) &rarr;</span>
        <select class="field-input" id="match-target" onchange="state.matchTarget=this.value"></select>
      </div>
    </div>
  </section>

  <!-- Step 4: Download -->
  <section class="step-content" data-step="3">
    <div class="card">
      <h2 id="download-title">–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞</h2>
      <p class="card-desc" id="download-desc">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ —Å–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</p>
      <h3 id="device-title">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h3>
      <div class="presets" id="device-presets"></div>
      <p class="hint" id="device-hint"></p>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h3 id="preview-title" style="margin:0">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h3>
        <button class="btn btn-sm btn-outline" id="copy-btn" onclick="copyConfig()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
      <pre class="preview" id="config-preview"></pre>
    </div>

    <div style="text-align:center;padding:12px 0">
      <button class="btn btn-lg btn-success" id="download-btn" onclick="downloadConfig()">–°–∫–∞—á–∞—Ç—å config.yaml</button>
    </div>
  </section>

  <!-- Bottom Nav -->
  <div class="nav">
    <button class="btn btn-outline" id="btn-prev" onclick="prevStep()" style="visibility:hidden">&larr; –ù–∞–∑–∞–¥</button>
    <div class="footer-error" id="footer-error" aria-live="polite"></div>
    <button class="btn btn-primary" id="btn-next" onclick="nextStep()">–î–∞–ª–µ–µ &rarr;</button>
  </div>
</div>

<div id="toasts"></div>

<div class="modal" id="subscription-modal" onclick="if(event.target===this)closeSubscriptionEditor()">
  <div class="modal-card">
    <h3 id="sub-modal-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–ø–∏—Å–∫–∏</h3>
    <p class="hint"><span id="subscription-edit-label">–ü–æ–¥–ø–∏—Å–∫–∞:</span> <span id="subscription-edit-name"></span></p>
    <input type="hidden" id="subscription-edit-index">
    <div class="field">
      <label class="field-label" id="sub-filter-label" for="subscription-edit-filter">–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ —Å–æ —Å–ª–æ–≤–∞–º–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏:</label>
      <input class="field-input" id="subscription-edit-filter" placeholder="^(HK|SG)|üá≠üá∞|üá∏üá¨">
    </div>
    <div class="field">
      <label class="field-label" id="sub-exclude-label" for="subscription-edit-exclude-filter">–ò—Å–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ —Å–æ —Å–ª–æ–≤–∞–º–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏:</label>
      <input class="field-input" id="subscription-edit-exclude-filter" placeholder="(?i)expire|test|trial">
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" id="sub-cancel-btn" onclick="closeSubscriptionEditor()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn btn-primary" id="sub-save-btn" onclick="saveSubscriptionEditor()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
